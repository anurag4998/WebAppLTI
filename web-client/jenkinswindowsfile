pipeline {
    agent any
    stages {
        stage('Deploy to development') { 
            steps {
              bat '''  echo "Add build steps here" ''' 
              bat '''  cd web-client && npm install ''' 
              bat ''' cd web-client && npm run build ''' 
              withAWS(region:'ap-south-1', credentials:'IAMuserLTI') {
                    s3Upload(bucket: 'reactjsdev', file:'web-client/build/')
                }
            }
        }
        stage('Deploy to production') {
            input{
              message 'Do you want to proceed ??'
            }
            steps {
                withAWS(region:'ap-south-1', credentials:'IAMuserLTI') {
                    s3Download bucket: 'reactjsdev', file:'web-client/build/', force: true
                    s3Upload bucket: 'forstaticwebhosting', file:'web-client/build/' 
//                     s3Copy fromBucket: 'reactjsdev', fromPath: '**/', toBucket: 'forstaticwebhosting', toPath: '**/'
                }
            }
        }
        stage("Commit changes back to production repo"){
            steps{
                bat ''' git checkout --track origin/dev ''' 
                bat ''' git checkout --track origin/master '''
                bat ''' git merge dev '''
                withCredentials([usernamePassword(credentialsId: 'mygithubcredentials', passwordVariable: 'GIT_PASSWORD', usernameVariable: 'GIT_USERNAME')]) {
                    sh('git push https://${GIT_USERNAME}:${GIT_PASSWORD}@github.com/vineetb95/WebAppLTI' )
                }
            }
        }
    }
}
